## 0. PRD Rules

- 본 문서는 commerce scope의 시스템 행동 요구사항만 정의한다
- UI 표현(디자인/레이아웃)은 포함하지 않는다
- 명시되지 않은 기능은 구현 대상이 아니다

---

## 1. Product Catalog

### 1.1 상품 등록 단위

- 시스템은 판매 상품을 관리한다
- 상품 카테고리는 MVP에서 다음 3개로 고정한다:
    - 강아지 사료
    - 강아지 간식
    - 강아지 놀이기구

### 1.2 상품 조회

- 시스템은 상품 목록 조회를 제공한다
- 목록은 페이지네이션을 사용한다(`page`, `size`)
- 시스템은 카테고리 기반 필터를 제공한다

### 1.3 상품 상세

- 시스템은 상품 상세 조회를 제공한다
- 상세에는 최소한 다음 정보가 포함되어야 한다:
    - 상품명
    - 가격
    - 카테고리
    - 재고 수량
    - 설명

가격/재고 규칙 (MVP 고정)

- 가격은 KRW 기준 정수 금액으로 저장/처리한다
- 가격은 0 이상이어야 한다
- 재고 수량은 0 이상 정수여야 한다

---

## 2. Cart

### 2.1 장바구니 추가/수정/삭제

- 시스템은 로그인 사용자의 장바구니를 관리한다
- 상품 수량은 1 이상이어야 한다
- 품절 상품은 장바구니 추가를 허용하지 않는다

수량 규칙 (MVP 고정)

- 장바구니 항목 수량은 1~99 범위로 제한한다
- 동일 사용자-동일 상품은 장바구니에 1개 라인만 허용한다(수량 갱신)

### 2.2 장바구니 조회

- 시스템은 로그인 사용자의 장바구니 항목 목록을 조회할 수 있어야 한다
- 항목에는 상품 기본 정보와 수량, 단가, 소계가 포함된다

---

## 3. Order

### 3.1 주문 생성

- 시스템은 장바구니를 기준으로 주문을 생성할 수 있어야 한다
- 주문 생성 시 재고를 검증해야 한다
- 주문 생성 시 사용자 포인트 잔액을 검증해야 한다
- 주문 생성 성공 시 주문 상태는 `CREATED`다

주문 생성 규칙 (MVP 고정)

- 결제 방식은 `POINT_ONLY`다 (외부 PG 없음)
- 주문 시점에 상품 단가를 스냅샷(`order_items.unit_price`)으로 저장한다
- 주문 총액은 `sum(order_items.subtotal_price)`와 같아야 한다
- 포인트 잔액이 주문 총액보다 부족하면 주문 생성은 전체 실패한다 (부분 성공 금지)
- 주문 생성 성공 시 즉시 포인트를 차감한다
- 주문 생성 성공 시 즉시 재고를 차감한다
- 재고 부족 항목이 1개라도 있으면 주문 생성은 전체 실패한다(부분 주문 없음)

### 3.2 주문 조회

- 시스템은 본인 주문 목록/상세 조회를 제공해야 한다
- 주문 목록은 페이지네이션을 적용한다

### 3.3 주문 상태

- 주문 상태는 MVP에서 다음만 사용한다:
    - `CREATED`
    - `CANCELED`
- 취소는 `CREATED` 상태에서만 허용한다

주문 상태 전이 규칙 (MVP 고정)

- 허용 전이: `CREATED -> CANCELED`
- 금지 전이: `CANCELED -> CREATED`
- 주문 취소 성공 시 주문 시점에 차감한 재고를 복원한다
- 주문 취소 성공 시 주문 시점에 차감한 포인트를 환불한다

### 3.4 포인트

- 시스템은 인증 사용자의 현재 포인트 잔액 조회를 제공한다
- 시스템은 포인트 거래 이력 조회를 제공할 수 있다 (MVP 선택 기능)

포인트 규칙 (MVP 고정)

- 포인트는 KRW와 동일한 정수 금액 단위로 저장/처리한다
- 잔액은 0 미만이 될 수 없다
- 거래 유형은 `CHARGE`, `SPEND`, `REFUND`를 사용한다
- 포인트 거래 이력은 잔액 스냅샷(`balance_after`)을 포함한다

---

## 4. Auth / Authorization

- 장바구니/주문 API는 인증 사용자를 기준으로 동작한다
- 본인 데이터만 접근 가능하다
- 관리 기능(상품 등록/재고 조정)은 별도 관리자 권한 모델 도입 전까지 내부 운영 API로 제한한다

---

## 5. Frontend Shopping Tab

- Frontend는 기존 앱에 Shopping 탭을 추가한다
- Shopping 탭은 최소한 다음 페이지 흐름을 가진다:
    - 상품 목록
    - 상품 상세
    - 장바구니
    - 주문 목록

---

## 6. Non-Goals (MVP)

- 결제 승인/실패 처리(외부 PG)
- 쿠폰/프로모션
- 배송 추적
- 리뷰/평점(쇼핑 상품 기준)
